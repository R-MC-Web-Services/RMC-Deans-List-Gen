<html>
    <head>
        <title>Table Gen</title>
    </head>
    <body>

    
<input type="file" id="excelInput" accept=".xlsx,.xls" />
<br /><br />

<textarea id="tableOutput" rows="26" cols="100"
  placeholder="Searchable, modal-enabled table HTML will appear here..."></textarea>
<br />
<button id="copyBtn">Copy Table HTML</button>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
const excelInput = document.getElementById('excelInput');
const tableOutput = document.getElementById('tableOutput');
const copyBtn = document.getElementById('copyBtn');

excelInput.addEventListener('change', function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function (evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: 'array' });

    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });

    let html = `
<input type="text" id="studentSearch"
  placeholder="Search by student nameâ€¦"
  onkeyup="filterStudents()" />

<table id="studentTable">
  <thead>
    <tr><th>Name</th><th>Major</th></tr>
  </thead>
  <tbody>
`;

    rows.forEach(row => {
      const fullName = `${row.first_name} ${row.last_name}`.trim();
      const fileName = `Fall25-${row.first_name}${row.last_name}.png`;

      html += `
<tr>
  <td>
    <a href="#" onclick="openModal('${escapeJS(fileName)}', '${escapeJS(fullName)}'); return false;">
      ${escapeHTML(fullName)}
    </a>
  </td>
  <td>${escapeHTML(row.major)}</td>
</tr>
`;
    });

    html += `
  </tbody>
</table>

<!-- Modal -->
<div id="studentModal" class="student-modal">
  <div class="student-modal-content">
    <span class="student-modal-close" onclick="closeModal()">&times;</span>

    <img id="studentModalImage" src="" alt="" />

    <div class="student-share">
      <a id="shareFacebook" target="_blank" class="share-btn fb">Facebook</a>
      <a id="shareTwitter" target="_blank" class="share-btn tw">Twitter</a>
    </div>
  </div>
</div>

<style>
.student-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  z-index: 9999;
}

.student-modal-content {
  position: relative;
  margin: auto;
  top: 50%;
  transform: translateY(-50%);
  width: 80%;
  max-height: 90vh;
  text-align: center;
}

@media (min-width: 992px) {
  .student-modal-content {
    width: 60%;
  }
}

.student-modal-content img {
  max-width: 100%;
  max-height: 70vh;
}

.student-modal-close {
  position: absolute;
  top: -12px;
  right: -12px;
  font-size: 32px;
  color: white;
  cursor: pointer;
}

.student-share {
  margin-top: 15px;
  display: flex;
  justify-content: center;
  gap: 15px;
}

.share-btn {
  padding: 10px 18px;
  color: white;
  text-decoration: none;
  font-weight: 600;
  border-radius: 4px;
}

.share-btn.fb { background: #1877f2; }
.share-btn.tw { background: #1da1f2; }
</style>

<script>
function filterStudents() {
  const filter = document.getElementById('studentSearch').value.toLowerCase();
  document.querySelectorAll('#studentTable tbody tr').forEach(row => {
    row.style.display = row.cells[0].textContent.toLowerCase().includes(filter)
      ? '' : 'none';
  });
}

function openModal(fileName, studentName) {
  const modal = document.getElementById('studentModal');
  const img = document.getElementById('studentModalImage');

  img.src = '/wp-content/images/' + fileName;
  img.alt = studentName;

  const message = encodeURIComponent(
    studentName + ' has earned a place on the Randolph-Macon College Dean\\'s List!'
  );
  const link = encodeURIComponent('https://www.rmc.edu/academics/deans-list/');

  document.getElementById('shareFacebook').href =
    'https://www.facebook.com/sharer/sharer.php?u=' + link + '&quote=' + message;

  document.getElementById('shareTwitter').href =
    'https://twitter.com/intent/tweet?text=' + message + '&url=' + link;

  modal.style.display = 'block';
}

function closeModal() {
  document.getElementById('studentModal').style.display = 'none';
}

document.addEventListener('click', function (e) {
  const modal = document.getElementById('studentModal');
  if (e.target === modal) closeModal();
});

document.addEventListener('keydown', function (e) {
  if (e.key === 'Escape') closeModal();
});
<\/script>
`;

    tableOutput.value = html;
  };

  reader.readAsArrayBuffer(file);
});

copyBtn.addEventListener('click', function () {
  tableOutput.select();
  navigator.clipboard.writeText(tableOutput.value)
    .then(() => alert('HTML copied to clipboard'));
});

function escapeHTML(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

function escapeJS(str) {
  return String(str).replace(/'/g, "\\'");
}
</script>
</body>
</html>